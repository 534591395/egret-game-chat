var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(t){try{h(r.next(t))}catch(e){s(e)}}function a(t){try{h(r["throw"](t))}catch(e){s(e)}}function h(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,a)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,s=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){h.label=n[1];break}if(6===n[0]&&h.label<o[1]){h.label=o[1],o=n;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(n);break}o[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(r){n=[6,r],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,o,a,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function r(r){e.call(n,r,t)}if(RES.hasRes(t)){var i=RES.getRes(t);i?r(i):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return[4,this.loadResource()];case 1:return n.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=n.sent(),[4,platform.login()];case 3:return n.sent(),[4,platform.getUserInfo()];case 4:return e=n.sent(),console.log(e),this.start(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return n.sent(),this.stage.removeChild(t),[3,5];case 4:return e=n.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){},e.prototype.start=function(){var t=new Index;t.x=Util.horizontalCenter(this.stage.stageWidth,320),this.addChild(t),t.addEventListener(MainEvent.GameStart,this.gameStart,this)},e.prototype.gameStart=function(t){var e=this.getChildAt(0);e.removeEventListener(MainEvent.GameStart,this.gameStart,this),this.removeChildAt(0),this.game=new Game,this.addChild(this.game),this.game.start()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var MainEvent=function(t){function e(e,n,r,i){void 0===n&&(n=""),void 0===r&&(r=!1),void 0===i&&(i=!1);var s=t.call(this,e,r,i)||this;return s._resName="",s._resName=n,s}return __extends(e,t),Object.defineProperty(e.prototype,"resName",{get:function(){return this._resName},enumerable:!0,configurable:!0}),e.GameStart="开始游戏",e.Restart="重新开始",e}(egret.Event);__reflect(MainEvent.prototype,"MainEvent");var Game=function(t){function e(){var e=t.call(this)||this;return e.timeNum=0,e.timeMax=30,e.time=0,e.cloudMaxNumber=13,e.nowCloudNumber=13,e.isPause=!0,e.times=60,e.sfct=368,e.wj=0,e.wy=0,e.my=416,e.tch=0,e.scr_m=0,e.scr_p=0,e.spjpa=0,e.wbgy=832,e.twy=56,e.scc=0,e.mj=-18,e.tcd=1,e.t=0,e.bp_fi=0,e.pcfi=0,e.personArr=[],e.touchStatus=!1,e.distance=new egret.Point,e.particleTypeArr=[],e.numberDistance=0,e.cloudBottomVisable=!0,e.width=320,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStages,e),e}return __extends(e,t),e.prototype.onAddToStages=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStages,this),this.pannelUI=new Pannels,this.pannelUI.x=Util.horizontalCenter(this.stage.stageWidth,320),this.pannelUI.name="pannelUI",this.addChild(this.pannelUI),this.restartUI=new Restarts,this.restartUI.x=Util.horizontalCenter(this.stage.stageWidth,this.restartUI.width),this.restartUI.name="restartUI",this.addChild(this.restartUI),this.restartUI.addEventListener(MainEvent.Restart,this.start,this),this.personArr.push(Util.createBitmapByName("imgMerger#person_1")),this.personArr.push(Util.createBitmapByName("imgMerger#person_3")),this.personArr.push(Util.createBitmapByName("imgMerger#person_2")),this.personArr.push(Util.createBitmapByName("imgMerger#person_4")),this.particleTypeArr.push(Util.createBitmapByName("imgMerger#particle_sm_green_2")),this.particleTypeArr.push(Util.createBitmapByName("imgMerger#particle_sm_blue_2")),egret.startTick(this.onEnterFrame,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchStart,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)},e.prototype.touchStart=function(t){this.touchStatus=!0,this.nowPerson&&(this.distance.x=t.stageX-this.nowPerson.x,this.distance.y=t.stageY-this.nowPerson.y)},e.prototype.touchMove=function(t){this.nowPerson&&this.touchStatus&&(this.nowPerson.x=t.stageX-this.distance.x,this.nowPerson.x>=this.stage.width/2?this.t=1:this.t=0)},e.prototype.touchEnd=function(t){this.touchStatus=!1},e.prototype.start=function(){this.removeChild(this.restartUI),this.clearClouds(this.pannelUI.cloudBox),this["default"](),this.particle(),this.addDefalutClouds(),this.timerStart(),this.numberDistance=0,this.pannelUI.cloudBottomType=1,this.nowPerson=this.personArr[0],this.nowPerson.name="0",this.pannelUI.personBox.addChild(this.nowPerson)},e.prototype.stop=function(){this.pannelUI.personBox.removeChild(this.nowPerson),this.addChild(this.restartUI),this.isPause=!0,this.restartUI.nowDistance=300,this.restartUI.historyDistance=400},e.prototype["default"]=function(){this.poolList=[],this.sfcy=this.pannelUI.cloudBottomBgYMin,this.wj=this.wy=0,this.tch=this.scr_m=this.scr_p=this.spjpa=0,this.my=416,this.wbgy=-832,this.twy=56,this.scc=0,this.mj=-18,this.sfct=368,this.tcd=1,this.spjpa=0,this.t=0,this.bp_fi=0,this.pcfi=0,this.cloudBottomVisable=!0},e.prototype.onEnterFrame=function(t){var e=t,n=this.time,r=e-n;return this.timeNum+=r,this.timeNum>this.timeMax&&(this.timeNum=0,this.isPause||(this.wj=100-this.my,this.wj<1?this.wj=0:this.scr_m+=this.wj/5,this.wj>37&&(this.wj=37),this.twy-=this.wj/3,this.twy<0&&(this.twy+=104),this.wbgy+=.08,this.pannelUI.bgY=this.wbgy,this.cloudBottomBgMove(),this.person(),this.stepClouds())),this.time=e,!1},e.prototype.timerStart=function(){this.isPause=!1,this.pannelUI.countNumber=this.times,this.timer=new egret.Timer(1e3,this.times),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.start()},e.prototype.timerFunc=function(t){var e=t.target.currentCount;this.pannelUI.countNumber=this.times-e},e.prototype.timerComFunc=function(t){console.log("倒计时结束"),this.stop()},e.prototype.particle=function(){var t=this.particleTypeArr[1].texture,e=RES.getRes("paopao_json");this.system=new particle.GravityParticleSystem(t,e),this.system.endAlpha=0,this.pannelUI.personBox.addChild(this.system)},e.prototype.addDefalutClouds=function(){for(var t=0;t<this.cloudMaxNumber;t++){var e=36*Math.floor(7*Math.random()),n=40*t;t>=10&&(n=40*Math.floor(9*Math.random()));var r=void 0;r=100*Math.random()>10?"blue":"green";var i=this.getCloud(r);i.x=e,i.y=n,this.pannelUI.cloudBox.addChild(i)}this.nowCloudNumber=this.cloudMaxNumber},e.prototype.cloudBottomBgMove=function(){if(-1!==this.sfcy){var t=0===this.scc?1:0;this.sfcy+=this.wj*t,this.pannelUI.cloudBottomBgY=this.sfcy,this.my>this.pannelUI.personBox.height-this.nowPerson.height&&this.mj>0?(this.sfcy=this.my+42,this.my>this.pannelUI.personBox.height&&this.cloudBottomVisable&&(this.mj=-18)):(this.sfcy+=(this.sfct-this.sfcy)/5,416===this.sfct&&this.sfcy>this.pannelUI.cloudBottomBgYMin&&(this.sfcy=-1)),this.my+=(this.mj+this.wj)*this.tcd,this.mj+=.6,this.mj>8&&(this.mj=8)}this.numberDistance>200&&(this.cloudBottomVisable=!1,this.pannelUI.cloudBottomBgY=460)},e.prototype.person=function(){var t="0";if(t=this.t>0?this.mj>0?"3":"2":this.mj>0?"1":"0",this.nowPerson.name!==t){var e=this.nowPerson.x,n=this.nowPerson.y;this.pannelUI.personBox.removeChild(this.nowPerson),this.nowPerson=this.personArr[Number(t)],this.nowPerson.name=t,this.nowPerson.x=e,this.nowPerson.y=n,this.pannelUI.personBox.addChild(this.nowPerson)}this.nowPerson.y=this.my,this.cloudBottomVisable||this.nowPerson.y>400&&this.stop()},e.prototype.brid=function(){},e.prototype.updateClouds=function(){for(var t=this.pannelUI.cloudBox,e=0;e<t.numChildren;e++){var n=t.getChildAt(e);n&&(n.y+=40,n.y>this.pannelUI.cloudBox.height&&(this.clearCloud(t,e),this.nowCloudNumber--))}for(var r=0;r<this.cloudMaxNumber-this.nowCloudNumber;r++){var i=36*Math.floor(7*Math.random()),s=40*r;r>=10&&(s=40*Math.floor(9*Math.random()));var o=void 0;o=100*Math.random()>10?"blue":"green";var n=this.getCloud(o);n.x=i,n.y=s,this.pannelUI.cloudBox.addChild(n)}this.nowCloudNumber=this.cloudMaxNumber},e.prototype.stepClouds=function(){if(!(this.mj<=0))for(var t=this.pannelUI.cloudBox,e=0;e<t.numChildren;e++){var n=t.getChildAt(e);if(n){var r=Math.floor(n.y/40),i=Math.floor(n.x/36),s=Math.floor(this.nowPerson.x/36),o=Math.floor(this.nowPerson.y/40);s===i&&o===r&&(this.my=n.y-40,this.mj=-18,"green"===n.name?this.system.changeTexture(this.particleTypeArr[0].texture):"blue"===n.name&&this.system.changeTexture(this.particleTypeArr[1].texture),this.system.start(500),this.system.emitterX=n.x,this.system.emitterY=n.y,this.clearCloud(t,e),this.nowCloudNumber--,this.numberDistance+=40,this.pannelUI.numberDistance=this.numberDistance,this.updateClouds())}}},e.prototype.getCloud=function(t){var e,n=this.poolList.filter(function(e){return e.name===t});return n.length?(e=n.pop(),this.poolList=this.poolList.filter(function(t){return t!=e})):(e=Util.createBitmapByName("imgMerger#cloud_"+t),e.name=t),e},e.prototype.destroyCloud=function(t,e){e.removeChild(t),this.poolList.push(t)},e.prototype.clearClouds=function(t){for(var e,n=[],r=0;r<t.numChildren;r++){var i=t.getChildAt(r);n.push(i)}for(;n.length;)e=n.shift(),this.destroyCloud(e,t)},e.prototype.clearCloud=function(t,e){var n=t.getChildAt(e);this.destroyCloud(n,t)},e}(eui.UILayer);__reflect(Game.prototype,"Game");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,r){function i(t){e.call(r,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),n.call(r))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(h,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(r,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Util=function(){function t(){}return t.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},t.horizontalCenter=function(t,e){return(t-e)/2},t}();__reflect(Util.prototype,"Util");var Index=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/skins/Index.exml",e.event(),e}return __extends(e,t),e.prototype.event=function(){var t=this,e=new MainEvent(MainEvent.GameStart);this.gameStart.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEvent(e)},this)},e}(eui.Component);__reflect(Index.prototype,"Index");var Pannels=function(t){function e(){var e=t.call(this)||this;e._numberHit=0,e._countNumber=60,e._numberDistance=0,e._bgY=-832,e._cloudBottomBgY=368,e.cloudBottomBgYMin=368,e.cloudBottomBgYMax=416,e.skinName="resource/skins/Pannel.exml",e.event();var n=new egret.Rectangle(0,0,320,480);return e.bgBox.mask=n,e}return __extends(e,t),e.prototype.event=function(){},Object.defineProperty(e.prototype,"countNumber",{get:function(){return this._countNumber},set:function(t){this._countNumber=t;var e;e=10>t?"0"+t:t+"",this.countTimeLeft.source="number_blue_"+e[0],this.countTimeRight.source="number_blue_"+e[1],this.countDownBar.width=294*(t/60)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberHit",{get:function(){return this._numberHit},set:function(t){this._numberHit=t;var e=t+"";1===e.length&&(e="00"+e),2===e.length&&(e="0"+e),this.numberScoreOne.source="number_score_"+e[0],this.numberScoreTwo.source="number_score_"+e[1],this.numberScoreThree.source="number_score_"+e[2],this.scoreProgressBar.width=48*(t/10)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberDistance",{get:function(){return this._numberDistance},set:function(t){this._numberDistance=t;var e=t+"";1===e.length&&(e="000"+e),2===e.length&&(e="00"+e),3===e.length&&(e="0"+e),4===e.length&&(e=""+e),this.numberDistanceOne.source="number_distance_"+e[0],this.numberDistanceTwo.source="number_distance_"+e[1],this.numberDistanceThree.source="number_distance_"+e[2],this.numberDistanceFour.source="number_distance_"+e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bgY",{get:function(){return this._bgY},set:function(t){this.bg.y=t,this._bgY=this.bg.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cloudBottomType",{set:function(t){this.cloudBottomBg.source="cloud_bottom_"+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cloudBottomBgY",{get:function(){return this._cloudBottomBgY},set:function(t){this.cloudBottomBg.y=t,this._cloudBottomBgY=this.cloudBottomBg.y},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(Pannels.prototype,"Pannels");var Restarts=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/skins/Restart.exml",e.event(),e}return __extends(e,t),e.prototype.event=function(){var t=this,e=new MainEvent(MainEvent.Restart);this.restart.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEvent(e)},this)},Object.defineProperty(e.prototype,"nowDistance",{set:function(t){for(var e=t+"",n=this.nowDistanceBox.width-33*e.length,r=0;r<e.length;r++){var i=Util.createBitmapByName("imgMerger#number_yellow_"+e[r]);i.x=33*r+n,this.nowDistanceBox.addChild(i)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"historyDistance",{set:function(t){for(var e=t+"",n=this.historyDistanceBox.width-13*e.length,r=0;r<e.length;r++){var i=Util.createBitmapByName("imgMerger#number_white_"+e[r]);i.x=13*r+n,this.historyDistanceBox.addChild(i)}},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(Restarts.prototype,"Restarts");
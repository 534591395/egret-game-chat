var __reflect=this&&this.__reflect||function(t,e,s){t.__class__=e,s?s.push(e):s=[e],t.__types__=t.__types__?s.concat(t.__types__):s},__extends=this&&this.__extends||function(t,e){function s(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);s.prototype=e.prototype,t.prototype=new s},__awaiter=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))(function(r,a){function n(t){try{o(i.next(t))}catch(e){a(e)}}function h(t){try{o(i["throw"](t))}catch(e){a(e)}}function o(t){t.done?r(t.value):new s(function(e){e(t.value)}).then(n,h)}o((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function s(t){return function(e){return i([t,e])}}function i(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=a[2&s[0]?"return":s[0]?"throw":"next"])&&!(n=n.call(a,s[1])).done)return n;switch(a=0,n&&(s=[0,n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,a=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(n=o.trys,!(n=n.length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(i){s=[6,i],a=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}var r,a,n,h,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return h={next:s(0),"throw":s(1),"return":s(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},BgColor=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/eui_skins/Bg.exml",e.width=320,e}return __extends(e,t),e}(eui.Component);__reflect(BgColor.prototype,"BgColor");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,s){function i(i){e.call(s,i,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?i(r):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.zIndexNum=999999,e.sttype=[],e.extraleft=[],e.extraright=10,e.logh=20,e.stmargin=[],e.stwidth=[],e.sts=0,e.timeNum=0,e.timeMax=15,e.time=0,e.dnd=0,e.stscore=0,e.gameisover=1,e.gamesplayed=0,e.perfectOperationNum=0,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return s.sent(),[4,this.loadTheme()];case 2:return s.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return s.sent(),this.stage.removeChild(t),[3,5];case 4:return e=s.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,s){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.gameLayer=new egret.DisplayObjectContainer,this.addChild(this.gameLayer),this.bgUI(),this.panel(),this.markUI(),this.startUI()},e.prototype.tipUI=function(){var t=this,e=new Tip;this.scrollareaLayer.addChild(e),egret.Tween.get(e).to({alpha:0,y:100},400).call(function(){t.scrollareaLayer.removeChild(e)})},e.prototype.bgUI=function(){var t=new BgColor;t.x=Utiles.horizontalCenter(this.stage.stageWidth,t.width),this.gameLayer.addChild(t)},e.prototype.startUI=function(){var t=new Start;t.x=Utiles.horizontalCenter(this.stage.stageWidth,t.width),this.gameLayer.addChild(t),t.addEventListener(MainEvent.GameStart,this.gameStart,this)},e.prototype.restartUI=function(){var t=new Restart;t.x=Utiles.horizontalCenter(this.stage.stageWidth,t.width),this.gameLayer.addChild(t)},e.prototype.panel=function(){var t=new Panel;t.x=Utiles.horizontalCenter(this.stage.stageWidth,t.width),this.panelUI=t,this.gameLayer.addChild(t),this.scrollareaLayer=t.scrollareaLayer,this.scrollareaLayer.sortableChildren=!0,t.addEventListener(MainEvent.Down,this.down,this)},e.prototype.down=function(){if(1!==this.dnd&&1!=this.gameisover){1===this.dnd,egret.stopTick(this.moveStack,this);var t="";this.stmargin[this.sts]<this.stmargin[this.sts-1]&&(this.stwidth[this.sts]-=this.stmargin[this.sts-1]-this.stmargin[this.sts],this.stmargin[this.sts]=this.stmargin[this.sts-1],t="left"),this.stmargin[this.sts]+this.stwidth[this.sts]>this.stmargin[this.sts-1]+this.stwidth[this.sts-1]&&(this.stwidth[this.sts]-=this.stmargin[this.sts]+this.stwidth[this.sts]-this.stmargin[this.sts-1]-this.stwidth[this.sts-1],t="right"),this.stwidth[this.sts]<=0&&(t="all"),this.stwidth[this.sts]<=0&&(this.stwidth[this.sts]=0),this.sts%2==0&&this.stwidth[this.sts]>0;var e=Math.floor(this.stwidth[this.sts]/10*Math.log(this.sts+1)),s=this.scrollareaLayer.getChildByName("stp_"+this.sts);this.stwidth[this.sts]>0&&Math.abs(this.stwidth[this.sts]-this.stwidth[this.sts-1])<3&&(e*=2,this.perfectOperationNum+=1,this.panelUI.setPerfectOperation(this.perfectOperationNum),this.tipUI()),this.stscore+=e,this.panelUI.setScore(this.stscore),this.cutaronk(s,this.sttype[this.sts],this.stwidth[this.sts],t)}},e.prototype.cutaronk=function(t,e,s,i){if(t){var r,a=(parseInt(t.width),t.getChildAt(0));"right"===i?(this.showaronk(t,e,s),r=t.getChildAt(1),r.x=a.x):"left"===i&&(this.showaronk(t,e,s),r=t.getChildAt(1),r.x=a.width+a.x-r.width),""!=i&&(("left"===i||"right"===i)&&(t.y=this.sah-(this.sts+1)*(this.logh-4),egret.Tween.get(a).to({alpha:.25,y:a.height},200).call(function(){t.removeChild(a)})),this.stwidth[this.sts]>0?(this.addStack(),this.dnd=0):this.gameover())}},e.prototype.gameover=function(){this.gameisover=1,this.gamesplayed++,egret.localStorage.setItem("stack_gamesplayed",this.gamesplayed+"");var t=new Restart;t.x=Utiles.horizontalCenter(this.stage.stageWidth,t.width),t.y=80,t.setTip("游戏结束: "+this.stscore+", 再来一次?"),t.name="restartUI",t.addEventListener(MainEvent.Restartgame,this.restartGame,this),this.gameLayer.addChild(t),this.restart=t},e.prototype.restartGame=function(){egret.stopTick(this.moveStack,this),this.restart&&(this.gameLayer.removeChild(this.restart),this.restart=null),this.zIndexNum=999999,this.scrollareaLayer.removeChildren(),this.sts=0,this.gameisover=0,this.panelUI.setlevel(1),this.panelUI.setPerfectOperation(0),this.panelUI.setScore(this.stscore),this.saw=this.scrollareaLayer.width,this.sah=this.scrollareaLayer.height,this.extraleft[1]=6,this.extraleft[2]=4,this.extraleft[3]=5,this.extraleft[4]=5,this.sttype[0]=Math.floor(4*Math.random())+1,this.stwidth[0]=260,this.stmargin[0]=(this.saw-this.stwidth[0])/2;var t=new egret.DisplayObjectContainer;t.sortableChildren=!0,t.height=this.logh,t.y=this.sah-this.logh,t.x=this.stmargin[0]-this.extraleft[this.sttype[0]],t.name="stp_0",this.scrollareaLayer.addChild(t),this.showaronk(t,this.sttype[0],this.stwidth[0]),this.addStack()},e.prototype.addshadow=function(){var t=Utiles.createBitmapByName("dropshadow_png");t.name="shd_"+this.sts,t.width=this.extraleft[this.sttype[this.sts]]+this.stwidth[this.sts]+this.extraright/2,t.height=30,t.x=this.stmargin[this.sts]-this.extraleft[this.sttype[this.sts]],t.y+=this.sah-(this.sts+1)*(this.logh-4),this.scrollareaLayer.addChild(t)},e.prototype.markUI=function(){var t=new Marks;t.x=Utiles.horizontalCenter(this.stage.stageWidth,t.width),this.gameLayer.addChild(t)},e.prototype.gameStart=function(){var t=this.gameLayer.getChildAt(3);t&&t.removeEventListener(MainEvent.GameStart,this.gameStart,this),this.gameLayer.removeChildAt(3),this.gameLayer.removeChildAt(2),this.restartGame()},e.prototype.showaronk=function(t,e,s){var i=new egret.DisplayObjectContainer;i.width=this.extraleft[e]+s+this.extraright/2,i.height=this.logh;var r=Utiles.createBitmapByName(e+"2_png");r.width=s,r.height=this.logh,r.x=this.extraleft[e],i.addChild(r);var a=Utiles.createBitmapByName(e+"1_png");i.addChild(a);var n=Utiles.createBitmapByName(e+"3_png");n.x=this.extraleft[e]+s-this.extraright/2,i.addChild(n),t.addChild(i)},e.prototype.addStack=function(){var t=7,e=0;if(this.sts>t){var s=this.scrollareaLayer.getChildAt(this.scrollareaLayer.numChildren-1).y;this.scrollareaLayer.removeChildAt(0);for(var i=0;i<this.scrollareaLayer.numChildren;i++){var r=this.scrollareaLayer.getChildAt(i);r.y=this.sah-(i+1)*(this.logh-4)}e=s-this.scrollareaLayer.getChildAt(this.scrollareaLayer.numChildren-1).y}this.sts++,this.panelUI.setlevel(Math.floor(this.sts/t)+1),this.stwidth[this.sts]=this.stwidth[this.sts-1],this.stmargin[this.sts]=0,this.stdir=2*Math.log(this.sts+1),this.sttype[this.sts]=Math.floor(4*Math.random())+1,Math.random()>.5&&(this.stdir*=-1,this.stmargin[this.sts]=this.saw-this.stwidth[this.sts]);var a=new egret.DisplayObjectContainer;a.sortableChildren=!0,a.name="stp_"+this.sts,a.height=this.logh,a.width=this.extraleft[this.sttype[this.sts]]+this.stwidth[this.sts]+this.extraright/2,a.y=this.sah-(this.sts+2)*(this.logh-4)-e,a.x=this.stmargin[this.sts]-this.extraleft[this.sttype[this.sts]],this.scrollareaLayer.addChild(a),this.showaronk(a,this.sttype[this.sts],this.stwidth[this.sts]),egret.startTick(this.moveStack,this)},e.prototype.moveStack=function(t){var e=t,s=this.time,i=e-s;if(this.timeNum+=i,this.timeNum>this.timeMax){this.timeNum=0,this.stmargin[this.sts]+=this.stdir,this.stmargin[this.sts]<0?(this.stmargin[this.sts]=-this.stmargin[this.sts],this.stdir*=-1):this.stmargin[this.sts]+this.stwidth[this.sts]>this.saw&&(this.stmargin[this.sts]=this.saw-this.stwidth[this.sts],this.stdir*=-1);var r=this.scrollareaLayer.getChildByName("stp_"+this.sts);r&&(r.x=this.stmargin[this.sts]-this.extraleft[this.sttype[this.sts]])}return this.time=e,!1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,s,i){function r(t){e.call(i,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),s.call(i))}var n=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,s){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},n)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var h=t.split("/");h.pop();var o=h.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(i,generateJSON.paths[t])},this):RES.getResByUrl(o,function(s){window.JSONParseClass.setData(s),egret.callLater(function(){e.call(i,generateJSON.paths[t])},n)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var MainEvent=function(t){function e(e,s,i,r){void 0===s&&(s=""),void 0===i&&(i=!1),void 0===r&&(r=!1);var a=t.call(this,e,i,r)||this;return a._resName="",a._resName=s,a}return __extends(e,t),Object.defineProperty(e.prototype,"resName",{get:function(){return this._resName},enumerable:!0,configurable:!0}),e.GameStart="游戏开始",e.Down="放木头",e.Restartgame="游戏重新开始",e}(egret.Event);__reflect(MainEvent.prototype,"MainEvent");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Marks=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/eui_skins/Mark.exml",e.width=320,e}return __extends(e,t),e}(eui.Component);__reflect(Marks.prototype,"Marks");var Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/eui_skins/Panel.exml",e.width=320,e.animate(),e}return __extends(e,t),e.prototype.animate=function(){var t=this,e=new MainEvent(MainEvent.Down);this.down.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEvent(e)},this)},e.prototype.setScore=function(t){this.score.text=t},e.prototype.setlevel=function(t){this.grade.text=t},e.prototype.setPerfectOperation=function(t){this.lianji.text=t},e}(eui.Component);__reflect(Panel.prototype,"Panel");var Restart=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/eui_skins/Restart.exml",e.animate(),e}return __extends(e,t),e.prototype.animate=function(){var t=this,e=new MainEvent(MainEvent.Restartgame);this.restartgame.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEvent(e)},this)},e.prototype.setTip=function(t){this.tip.text=t},e}(eui.Component);__reflect(Restart.prototype,"Restart");var Start=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/eui_skins/Start.exml",e.animate(),e}return __extends(e,t),e.prototype.animate=function(){var t=this,e=new MainEvent(MainEvent.GameStart);this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEvent(e)},this)},e}(eui.Component);__reflect(Start.prototype,"Start");var Tip=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/eui_skins/Tip.exml",e.width=100,e}return __extends(e,t),e}(eui.Component);__reflect(Tip.prototype,"Tip");var Utiles=function(){function t(){}return t.createBitmapByName=function(t){var e=new egret.Bitmap,s=RES.getRes(t);return e.texture=s,e},t.horizontalCenter=function(t,e){return(t-e)/2},t}();__reflect(Utiles.prototype,"Utiles");